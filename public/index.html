<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kenshi Resumes Backend</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <div class="main-wrapper">
    <!-- Feedback Panel -->
    <div class="panel feedback-panel" id="feedback-container">
      <h2>Client Feedback</h2>

        <!-- Feedback Summary -->
    <div class="feedback-summary" id="feedback-summary">
        <div class="indicator positive">Positive: 0</div>
        <div class="indicator medium">Medium: 0</div>
        <div class="indicator negative">Negative: 0</div>
    </div>

      <!-- One sample will exist initially -->
      <div class="feedback-item">
        <div class="feedback-rating">Rating: ⭐⭐⭐</div>
        <div class="feedback-message">"Good"</div>
      </div>
    </div>

    <!-- Main Content Panel -->
    <div class="panel mid-container">
      <h1 class="title">Kenshi Resumes Backend</h1>
      <p class="description">Welcome to the Kenshi Resumes Backend!</p>

      <p>This is a backend service for managing Kenshi Resumes.</p>
      <p>Links:</p>
      <ul>
        <li><a href="https://kenshi-resumes-ai-powered.vercel.app/">Frontend</a></li>
        <li><a href="https://t.me/resume2727bot">Kenshi Resumes Bot</a></li>
        <li><a href="https://github.com/Kenshi2727/Kenshi-Resumes-Backend">Backend Repository</a></li>
        <li><a href="https://console.neon.tech/app/projects/billowing-sound-45472486">NeonDB Postgres Database Deployment</a></li>
      </ul>
      <p>Contact: <a href="mailto:abhishekmathurofficial@gmail.com">Developer Mail</a></p>
    </div>
  </div>


  <!-- JS to add more feedback -->
    <!-- remove the <script type="module"> import… block entirely -->

  <script>
    document.addEventListener("DOMContentLoaded",()=>{
    const container = document.getElementById('feedback-container');

    // First, clear the sample
    container.querySelector('.feedback-item').remove();

    let positiveCount = 0;
    let mediumCount = 0;
    let negativeCount = 0;

    fetch('/api/feedbacks')
      .then(res => res.json())
      .then(feedbackData => {

        if(feedbackData.length >1 && feedbackData[0].rating === -1) {
          // If the first item is the default message, remove it
          feedbackData.shift();
        }

        // Optional: trim to latest 20
        if (feedbackData.length > 20) {
          feedbackData = feedbackData.slice(-20);
        }

        feedbackData.forEach(({ rating, feedback }) => {
          const item = document.createElement('div');
          item.className = 'feedback-item';
          item.innerHTML = `
            <div class="feedback-rating">Rating: ${'⭐'.repeat(rating>1?rating:0)}</div>
            <div class="feedback-message">"${feedback}"</div>
          `;
          container.appendChild(item);

          if(rating < 3) {
            item.style.backgroundColor = '#ffcccc'; // for low ratings
            negativeCount++;
          } else if (rating < 4) {
            item.style.backgroundColor = '#ffffcc'; // for medium ratings
            mediumCount++;
          } else {
            item.style.backgroundColor = '#ccffcc'; // for high ratings
            positiveCount++;
          }
        });

        // Update counts
        document.querySelector('.indicator.positive').textContent = `Positive: ${positiveCount}`;
        document.querySelector('.indicator.medium').textContent = `Medium: ${mediumCount}`;
        document.querySelector('.indicator.negative').textContent = `Negative: ${negativeCount}`;


        setInterval(()=>window.location.reload(), 15000); // Refresh every 15 seconds
      })
      .catch(err => console.error('Could not load feedback:', err));

    });
  </script>


</body>
</html>
